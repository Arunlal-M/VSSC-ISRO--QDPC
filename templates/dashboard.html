{% extends 'index.html' %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.css">
<style>
    .dashboard-card {
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease-in-out;
        background: white;
        border: none;
        height: 100%;
    }

    .dashboard-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .card-primary {
        border-left: 4px solid #4e73df;
    }

    .card-success {
        border-left: 4px solid #1cc88a;
    }

    .card-info {
        border-left: 4px solid #36b9cc;
    }

    .card-warning {
        border-left: 4px solid #f6c23e;
    }

    .card-danger {
        border-left: 4px solid #e74a3b;
    }

    .icon-box {
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        border-radius: 12px;
        color: white;
    }

    .icon-primary {
        background-color: #4e73df;
    }

    .icon-success {
        background-color: #1cc88a;
    }

    .icon-info {
        background-color: #36b9cc;
    }

    .icon-warning {
        background-color: #f6c23e;
    }

    .icon-danger {
        background-color: #e74a3b;
    }

    .card-title {
        font-size: 0.9rem;
        font-weight: 600;
        text-transform: uppercase;
        color: #5a5c69;
    }

    .card-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: #2e2e2e;
    }

    .card-percentage {
        font-size: 0.8rem;
        font-weight: 600;
    }

    .percentage-positive {
        color: #1cc88a;
    }

    .percentage-negative {
        color: #e74a3b;
    }

    .chart-container {
        position: relative;
        height: 300px;
        width: 100%;
    }

    .recent-activity {
        max-height: 400px;
        overflow-y: auto;
    }

    .activity-item {
        position: relative;
        padding-left: 2rem;
        padding-bottom: 1.5rem;
        border-left: 1px solid #e3e6f0;
    }

    .activity-item:last-child {
        padding-bottom: 0;
        border-left: 1px solid transparent;
    }

    .activity-item::before {
        content: "";
        position: absolute;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        left: -6px;
        top: 0;
        background-color: #4e73df;
    }

    .activity-time {
        font-size: 0.7rem;
        color: #b7b9cc;
    }

    .progress-sm {
        height: 0.5rem;
    }

    .resource-status {
        font-size: 0.8rem;
    }

    .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 5px;
    }

    .status-active {
        background-color: #1cc88a;
    }

    .status-warning {
        background-color: #f6c23e;
    }

    .status-critical {
        background-color: #e74a3b;
    }
</style>

<div class="page-wrapper">
    <div class="content">
        <div class="page-header">
            <div class="page-title">
                <h4>Dashboard Overview</h4>
                <p class="text-muted">Welcome back! Here's what's happening with your inventory today.</p>
            </div>
        </div>

        <div class="container-fluid">
            <!-- Summary Cards Row -->
            <div class="row mb-4">
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="dashboard-card card-primary">
                        <div class="d-flex align-items-center">
                            <div class="icon-box icon-primary me-3">
                                <i class="bi bi-tools"></i>
                            </div>
                            <div>
                                <div class="card-title">Equipment</div>
                                <div class="card-value">12</div>
                                <div class="card-percentage percentage-positive">
                                    <i class="bi bi-arrow-up"></i> 5.2% from last month
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="dashboard-card card-success">
                        <div class="d-flex align-items-center">
                            <div class="icon-box icon-success me-3">
                                <i class="bi bi-cart"></i>
                            </div>
                            <div>
                                <div class="card-title">Raw Materials</div>
                                <div class="card-value">14</div>
                                <div class="card-percentage percentage-positive">
                                    <i class="bi bi-arrow-up"></i> 12.4% from last month
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="dashboard-card card-info">
                        <div class="d-flex align-items-center">
                            <div class="icon-box icon-info me-3">
                                <i class="bi bi-cassette"></i>
                            </div>
                            <div>
                                <div class="card-title">Consumables</div>
                                <div class="card-value">28</div>
                                <div class="card-percentage percentage-negative">
                                    <i class="bi bi-arrow-down"></i> 3.1% from last month
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="dashboard-card card-warning">
                        <div class="d-flex align-items-center">
                            <div class="icon-box icon-warning me-3">
                                <i class="bi bi-box2"></i>
                            </div>
                            <div>
                                <div class="card-title">Products</div>
                                <div class="card-value">89</div>
                                <div class="card-percentage percentage-positive">
                                    <i class="bi bi-arrow-up"></i> 8.7% from last month
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="row mb-4">
                <div class="col-xl-8 mb-4">
                    <div class="dashboard-card">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="card-title">Inventory Overview</h6>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                                    This Month
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                    <li><a class="dropdown-item" href="#">Today</a></li>
                                    <li><a class="dropdown-item" href="#">This Week</a></li>
                                    <li><a class="dropdown-item" href="#">This Month</a></li>
                                    <li><a class="dropdown-item" href="#">This Year</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="inventoryChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-xl-4 mb-4">
                    <div class="dashboard-card">
                        <h6 class="card-title mb-3">Inventory Distribution</h6>
                        <div class="chart-container">
                            <canvas id="inventoryPieChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity and Resource Status -->
            <div class="row">
                <div class="col-lg-6 mb-4">
                    <div class="dashboard-card">
                        <h6 class="card-title mb-3">Recent Activity</h6>
                        <div class="recent-activity">
                            <div class="activity-item">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <strong>New equipment added</strong>
                                        <p class="mb-1">Centrifuge X-200 was added to inventory</p>
                                    </div>
                                    <span class="activity-time">2 mins ago</span>
                                </div>
                            </div>

                            <div class="activity-item">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <strong>Raw material batch received</strong>
                                        <p class="mb-1">Batch #RM-2023-045 (Acetone) received from Supplier A</p>
                                    </div>
                                    <span class="activity-time">1 hour ago</span>
                                </div>
                            </div>

                            <div class="activity-item">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <strong>Product batch completed</strong>
                                        <p class="mb-1">Batch #PB-2023-112 (Antibody Solution) manufacturing completed</p>
                                    </div>
                                    <span class="activity-time">3 hours ago</span>
                                </div>
                            </div>

                            <div class="activity-item">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <strong>Maintenance scheduled</strong>
                                        <p class="mb-1">Autoclave #AC-03 scheduled for maintenance on Friday</p>
                                    </div>
                                    <span class="activity-time">5 hours ago</span>
                                </div>
                            </div>

                            <div class="activity-item">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <strong>Low stock alert</strong>
                                        <p class="mb-1">Consumable "Sterile Pipettes" is running low (12 remaining)</p>
                                    </div>
                                    <span class="activity-time">Yesterday</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6 mb-4">
                    <div class="dashboard-card">
                        <h6 class="card-title mb-3">Resource Status</h6>
                        
                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-1">
                                <span class="resource-status">
                                    <span class="status-indicator status-active"></span>
                                    Equipment in use
                                </span>
                                <span>8/12 (67%)</span>
                            </div>
                            <div class="progress progress-sm">
                                <div class="progress-bar bg-success" role="progressbar" style="width: 67%" aria-valuenow="67" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-1">
                                <span class="resource-status">
                                    <span class="status-indicator status-warning"></span>
                                    Raw materials stock level
                                </span>
                                <span>14/20 (70%)</span>
                            </div>
                            <div class="progress progress-sm">
                                <div class="progress-bar bg-warning" role="progressbar" style="width: 70%" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-1">
                                <span class="resource-status">
                                    <span class="status-indicator status-critical"></span>
                                    Critical consumables
                                </span>
                                <span>3 items below threshold</span>
                            </div>
                            <div class="progress progress-sm">
                                <div class="progress-bar bg-danger" role="progressbar" style="width: 30%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-1">
                                <span class="resource-status">
                                    <span class="status-indicator status-active"></span>
                                    Products ready for QA
                                </span>
                                <span>5 batches</span>
                            </div>
                            <div class="progress progress-sm">
                                <div class="progress-bar bg-info" role="progressbar" style="width: 45%" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Inventory Line Chart
        const inventoryCtx = document.getElementById('inventoryChart').getContext('2d');
        const inventoryChart = new Chart(inventoryCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                datasets: [
                    {
                        label: 'Equipment',
                        data: [8, 9, 10, 11, 11, 12, 12],
                        borderColor: '#4e73df',
                        backgroundColor: 'rgba(78, 115, 223, 0.05)',
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Raw Materials',
                        data: [10, 11, 12, 12, 13, 13, 14],
                        borderColor: '#1cc88a',
                        backgroundColor: 'rgba(28, 200, 138, 0.05)',
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Consumables',
                        data: [25, 27, 28, 28, 27, 28, 28],
                        borderColor: '#36b9cc',
                        backgroundColor: 'rgba(54, 185, 204, 0.05)',
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Products',
                        data: [75, 78, 80, 82, 85, 87, 89],
                        borderColor: '#f6c23e',
                        backgroundColor: 'rgba(246, 194, 62, 0.05)',
                        tension: 0.3,
                        fill: true
                    }
                ]
            },
            options: {
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        ticks: {
                            precision: 0
                        }
                    }
                }
            }
        });

        // Inventory Pie Chart
        const pieCtx = document.getElementById('inventoryPieChart').getContext('2d');
        const pieChart = new Chart(pieCtx, {
            type: 'doughnut',
            data: {
                labels: ['Equipment', 'Raw Materials', 'Consumables', 'Components', 'Products'],
                datasets: [{
                    data: [12, 14, 28, 75, 89],
                    backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b'],
                    hoverBackgroundColor: ['#2e59d9', '#17a673', '#2c9faf', '#dda20a', '#be2617'],
                    hoverBorderColor: "rgba(234, 236, 244, 1)",
                }],
            },
            options: {
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.raw || 0;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = Math.round((value / total) * 100);
                                return `${label}: ${value} (${percentage}%)`;
                            }
                        }
                    }
                },
                cutout: '70%',
            }
        });
    });
</script>
{% endblock %}